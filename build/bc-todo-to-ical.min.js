javascript:(function(){/**%0A%20*%20BaseCamp%20TODO%20events%20in%20iCalendar%20format.%0A%20*%0A%20*%20This%20function%20will%20prompt%20you%20to%20create%20either%20standard%20calendar%20events%20or%20TODO%20events.%20After%20that,%0A%20*%20it%20will%20read%20through%20the%20BC%20TODOs%20on%20screen%20and%20create%20an%20iCalendar%20ICS%20file.%20%0A%20*%0A%20*%20NB!!!!!%20You%20should%20be%20careful%20where%20you%20do%20this%20in%20BaseCamp,%20and%20it's%20probably%20best%20to%20do%20it%20on%20your%0A%20*%20%22me%22%20page.%20Doing%20this%20on%20a%20whole%20task%20list%20page%20will%20give%20you%20a%20LOT%20of%20entries.%0A%20*%0A%20*%20Only%20works%20for%20entries%20that%20have%20due%20dates,%20and%20does%20not%20ignore%20tasks%20that%20may%20be%20hidden%20by%20the%20%22Due%20By%22%20filter.%0A%20*/%0A(function($)%7B%0A%09//%20Main%20calendar%20variables%0A%09var%20cal%20=%20%7B%0A%09%09todos:%20''%0A%09%7D;%0A%0A%09//%20Do%20some%20date%20stuff%20for%20today's%20date%0A%09var%20today%20=%20new%20Date();%0A%09var%20m%20=%20today.getMonth()%20+%201;%0A%09m%20=%20(%20m%20%3C%2010%20?%20'0'%20+%20m%20:%20m%20);%0A%0A%09var%20d%20=%20today.getDate();%0A%09d%20=%20(%20d%20%3C%2010%20?%20'0'%20+%20d%20:%20d%20);%0A%0A%09var%20h%20=%20today.getHours();%20%0A%09var%20mi%20=%20today.getMinutes();%0A%09mi%20=%20(%20mi%20%3C%2010%20?%20'0'%20+%20mi%20:%20mi%20);%0A%0A%09var%20sc%20=%20today.getSeconds();%0A%09sc%20=%20(%20sc%20%3C%2010%20?%20'0'%20+%20sc%20:%20sc%20);%0A%0A%09var%20created_ts%20=%20today.getFullYear()%20+%20''%20+%20m%20+%20d%20+%20'T'%20+%20h%20+%20mi%20+%20sc;%0A%0A%09var%20bc_item%20=%20'li.todo';%0A%0A%09var%20caltpl%20=%20%5B%0A%09%09'BEGIN:VCALENDAR',%0A%09%09'VERSION:2.0',%0A%09%09'PRODID:-//BaseCamp%20iCal%20Todos//NONSGML%20BC%20TODO//EN',%0A%09%09'METHOD:PUBLISH',%0A%09%09'%7Btodos%7D',%0A%09%09'END:VCALENDAR'%0A%09%5D.join(%22%5Cn%22);%0A%0A%09var%20todotpl%20=%20%5B%0A%09%09'BEGIN:VTODO',%0A%09%09'SEQUENCE:%7Bseq%7D',%0A%09%09'UID:%7Buid%7D',%20//todo-1756504-8740996-224831916@webdevstudios.com',%0A%09%09'DUE:%7Bdue%7D',%20//%2020160104T170000',%0A%09%09'STATUS:NEEDS-ACTION',%0A%09%09'SUMMARY:%20%7Bsummary%7D',%0A%09%09'DESCRIPTION:%20%7Burl%7D',%20//%20https://basecamp.com/1756504/projects/8740996/todos/224831916',%0A%09%09'BEGIN:VALARM',%0A%09%09'TRIGGER:-PT10M',%0A%09%09'ACTION:DISPLAY',%0A%09%09'DESCRIPTION:Reminder',%0A%09%09'END:VALARM',%0A%09%09'END:VTODO',%0A%09%09''%20//%20needed%20to%20add%20a%20line%20between%20todos%0A%09%5D.join(%22%5Cn%22);%0A%0A%09var%20caleventtpl%20=%20%5B%0A%09%09'BEGIN:VEVENT',%0A%09%09'CREATED:%7Bcreated_ts%7D',%0A%09%09'SEQUENCE:%7Bseq%7D',%0A%09%09'UID:%7Buid%7D',%0A%09%09'DTSTAMP:%7Bcreated_ts%7D',%0A%09%09'DTSTART:%7Bstart%7D',%0A%09%09'DTEND:%7Bdue%7D',%0A%09%09'SUMMARY:%7Bsummary%7D',%0A%09%09'DESCRIPTION:%7Burl%7D',%0A%09%09'BEGIN:VALARM',%0A%09%09'TRIGGER:-PT10M',%0A%09%09'ACTION:DISPLAY',%0A%09%09'DESCRIPTION:Reminder',%0A%09%09'ORGANIZER:donotreply@webdevstudios.com',%0A%09%09'END:VALARM',%0A%09%09'END:VEVENT',%0A%09%09''%0A%09%5D.join(%22%5Cn%22);%0A%0A%09var%20target_tpl%20=%20doevent%20?%20target_tpl%20:%20todotpl;%0A%0A%09if%20(%20doevent%20)%20%7B%0A%09%09target_tpl%20=%20caleventtpl;%0A%09%7D%0A%0A%09$(%20bc_item%20).each(function(index,%20el)%7B%0A%09%09$el%20=%20$(el);%0A%0A%09%09if%20(%20!%20$el.attr('data-due-datetime')%20)%20%7B%0A%09%09%09return;%0A%09%09%7D%0A%0A%09%09var%20todo%20=%20%7B%0A%09%09%09uid:%20$el.attr('id').replace(/_/g,%20'-'),%0A%09%09%09due:%20$el.attr('data-due-datetime').replace(/-/g,%20'')%20+%20'T170000',%0A%09%09%09url:%20'https://basecamp.com'%20+%20$el.attr('data-url'),%0A%09%09%09seq:%202,%0A%09%09%09summary:%20$el.find('div%20span.content%20a')%5B0%5D.innerText,%0A%09%09%09created_ts:%20created_ts%20+%20'Z',%0A%09%09%09start:%20created_ts%0A%09%09%7D;%0A%0A%09%09cal.todos%20+=%20dotpl(target_tpl,%20todo);%0A%09%7D);%0A%0A%09cal%20=%20dotpl(%20caltpl,%20cal%20);%0A%0A%09var%20data%20=%20new%20Blob(%5Bcal%5D,%20%7Btype:%20'text/calendar'%7D);%0A%09var%20file%20=%20window.URL.createObjectURL(data);%0A%0A%09window.location%20=%20file;%0A%0A%09var%20r;%0A%0A%09function%20dotpl(tpl,%20params)%20%7B%0A%09%09for%20(%20var%20k%20in%20params%20)%20%7B%0A%09%09%09if%20(%20!%20params.hasOwnProperty(%20k%20)%20)%20%7B%0A%09%09%09%09continue;%0A%09%09%09%7D%0A%09%09%09r%20=%20new%20RegExp();%0A%09%09%09r.compile(%20'%7B'%20+%20k%20+%20'%7D',%20'g'%20);%0A%0A%09%09%09tpl%20=%20tpl.replace(%20r,%20params%5Bk%5D%20);%0A%09%09%7D%0A%0A%09%09return%20tpl;%0A%09%7D%0A%7D)(jQuery);%0A})();